<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>个人简历</title>
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.174.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.174.0/examples/jsm/"
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #1a1a1a;  /* 更深的背景色 */
      color: #ffffff;  /* 默认文字颜色为白色 */
    }
    canvas {
      display: block;
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 300px !important;
      height: 300px !important;
      border-radius: 10px;
      z-index: 10;  /* 确保3D模型在简历内容之上 */
    }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: black;
      font-family: Arial, sans-serif;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 5px;
    }
    #dialog {
      position: absolute;
      color: white;
      font-family: Arial, sans-serif;
      background: rgba(0,0,0,0.7);
      padding: 15px;
      border-radius: 10px;
      max-width: 300px;
      max-height: 250px;
      display: none;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      margin-bottom: 10px;
      transition: all 0.3s ease;
      overflow-y: auto;
      word-wrap: break-word;
      transform-origin: left center;
      opacity: 0;
      transform: scale(0.9);
    }
    #dialog.visible {
      opacity: 1;
      transform: scale(1);
    }
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 450px;
      height: 300px;
      background: rgba(0,0,0,0.95);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      z-index: 1000;
      transition: all 0.3s ease;
      transform: translateX(0);  /* 初始状态 */
    }
    #chat-hide {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background: transparent;
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      z-index: 1001;
      transition: all 0.3s ease;
    }
    #chat-hide:hover {
      background: rgba(255,255,255,0.1);
      transform: scale(1.1);
    }
    #chat-show {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: none;  /* 初始隐藏 */
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s ease;
      border: none;
    }
    #chat-show:hover {
      background: rgba(0,0,0,0.9);
      transform: scale(1.1);
    }
    #chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px;
      color: white;
      font-family: Arial, sans-serif;
      scrollbar-width: thin;
      scrollbar-color: #222 transparent;  /* 滑块颜色更淡，轨道透明 */
    }
    ::-webkit-scrollbar {
      width: 4px;  /* 减小滚动条宽度 */
    }
    ::-webkit-scrollbar-track {
      background: transparent;  /* 轨道透明 */
    }
    ::-webkit-scrollbar-thumb {
      background: #222;  /* 滑块颜色更淡 */
      border-radius: 2px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #333;  /* 悬停时稍微明显一点 */
    }
    #chat-input-container {
      padding: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      gap: 10px;
    }
    #chat-input {
      flex-grow: 1;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    #send-button {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      background: #128fff;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #send-button:hover {
      background: #0f7ae6;
    }
    .message {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 5px;
    }
    .user-message {
      background: rgba(255,255,255,0.1);
      margin-left: 20%;
      display: inline-block;  /* 让背景宽度跟随文字 */
      max-width: 80%;  /* 最大宽度限制 */
      float: right;  /* 添加右对齐 */
      clear: both;  /* 清除浮动 */
    }
    .ai-message {
      background: rgba(18,143,255,0.2);
      margin-right: 20%;
      float: left;  /* 添加左对齐 */
      clear: both;  /* 清除浮动 */
    }
    #dialog::before {
      content: '';
      position: absolute;
      top: 17px;
      left: -9px;
      width: 0;
      height: 0;
      border-bottom: 10px solid transparent;
      border-top: 10px solid transparent;
      border-right: 10px solid rgba(0,0,0,0.7);
      transform: rotate(0deg);
      z-index: 1001;  /* 确保三角形在对话框之上 */
    }
    #loading-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.3s ease;
    }
    #loading-container.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #128fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #loading-text {
      color: white;
      font-family: Arial, sans-serif;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #progress-bar {
      width: 200px;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
    }
    #progress {
      width: 0%;
      height: 100%;
      background: #128fff;
      transition: width 0.1s linear;
    }
    #resume-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      padding: 20px 0;
      overflow-y: auto;
      z-index: 1;
      display: flex;
      justify-content: center;
      box-sizing: border-box;
    }
    .resume-content-wrapper {
      max-width: calc(100% - 600px);  /* 相应调整最大宽度 */
      margin: 0 auto;
      padding: 0 20px;
    }
    .resume-section {
      margin-bottom: 40px;
      opacity: 1;
      transform: none;
    }
    .resume-section h2 {
      color: #ffffff;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
      font-size: 1.8em;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    .resume-section h2::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 24px;
      background: #3498db;
      margin-right: 10px;
      border-radius: 2px;
    }
    .resume-content {
      color: #ffffff;
      line-height: 1.8;
    }
    .resume-content h3 {
      color: #ffffff;
      margin: 20px 0 15px;
      font-size: 1.4em;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .resume-content h3 .time {
      font-size: 0.85em;
      color: #b0b0b0;
      font-weight: normal;
    }
    .resume-content p {
      margin: 10px 0;
      color: #ffffff;
    }
    .resume-content ul {
      list-style: none;
      padding-left: 20px;
    }
    .resume-content li {
      margin-bottom: 12px;
      position: relative;
      color: #ffffff;
      line-height: 1.6;
    }
    .resume-content li:before {
      content: "•";
      color: #3498db;
      position: absolute;
      left: -20px;
      font-size: 1.2em;
    }
    .experience-item, .project-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .experience-item:hover, .project-item:hover {
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      border-color: #3498db;
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.08);
    }
    .experience-item h3, .project-item h3 {
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .experience-item .position {
      color: #3498db;
      font-size: 1.1em;
      margin: 5px 0;
    }
    .experience-item .achievement {
      color: #b0b0b0;
      font-style: italic;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(255, 255, 255, 0.1);
    }
    .project-item .tech-stack {
      color: #b0b0b0;
      font-size: 0.9em;
      margin: 5px 0;
    }
    .project-item .project-desc {
      color: #ffffff;
      margin: 10px 0;
      line-height: 1.6;
    }
    .project-item .results {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px dashed rgba(255, 255, 255, 0.1);
    }
    .project-item .results p {
      color: #ffffff;
      font-weight: 500;
      margin-bottom: 10px;
    }
    #chat-container {
      z-index: 1000;  /* 确保聊天框在最上层 */
    }
    #loading-container {
      z-index: 2000;  /* 确保加载界面在最上层 */
    }
    /* 新增头部样式 */
    .resume-header {
      display: flex;
      align-items: center;
      margin-bottom: 40px;
      background: rgba(255, 255, 255, 0.05);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.2);
    }
    .resume-photo {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 20px;
      border: 3px solid #3498db;
    }
    .resume-personal-info {
      display: flex;
      flex-direction: column;
    }
    .resume-personal-info h1 {
      margin: 0;
      font-size: 2.5em;
      color: #ffffff;
    }
    .resume-personal-info p {
      margin: 5px 0;
      color: #b0b0b0;
    }
    /* 添加公司logo样式 */
    .company-logo {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      object-fit: contain;
    }
    .experience-item h3 {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 20px;
    }
    /* 添加移动端适配样式 */
    @media screen and (max-width: 768px) {
      .resume-content-wrapper {
        max-width: 100%;
        padding: 0 15px;
      }

      .resume-header {
        flex-direction: column;
        text-align: center;
        padding: 20px;
      }

      .resume-photo {
        width: 120px;
        height: 120px;
        margin: 0 auto 15px;
      }

      .resume-personal-info h1 {
        font-size: 2em;
      }

      .resume-personal-info p {
        font-size: 0.9em;
      }

      canvas {
        width: 200px !important;
        height: 200px !important;
        bottom: 10px;
        left: 10px;
      }

      #chat-container {
        width: 100%;
        height: 100%;
        bottom: 0;
        right: 0;
        border-radius: 0;
        transform: translateX(100%);
      }

      #chat-container.show {
        transform: translateX(0);
      }

      #chat-hide {
        display: none;
      }

      #chat-show {
        display: flex;
        bottom: 10px;
        right: 10px;
      }

      #dialog {
        max-width: 200px;
        font-size: 0.9em;
      }

      .experience-item, .project-item {
        padding: 15px;
      }

      .experience-item h3, .project-item h3 {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .company-logo {
        width: 30px;
        height: 30px;
      }

      .time {
        font-size: 0.8em;
      }
    }

    /* 添加平板适配样式 */
    @media screen and (min-width: 769px) and (max-width: 1024px) {
      .resume-content-wrapper {
        max-width: calc(100% - 400px);
      }

      canvas {
        width: 250px !important;
        height: 250px !important;
      }

      #chat-container {
        width: 350px;
      }
    }
  </style>
</head>
<body>
  <!-- <div id="loading-container">
    <div class="loading-spinner"></div>
    <div id="loading-text">加载中...</div>
    <div id="progress-bar">
      <div id="progress"></div>
    </div>
  </div> -->
  <div id="dialog"></div>
  <div id="chat-container">
    <button id="chat-hide">×</button>
    <div id="chat-messages"></div>
    <div id="chat-input-container">
      <input type="text" id="chat-input" placeholder="输入消息...">
      <button id="send-button">发送</button>
    </div>
  </div>
  <button id="chat-show">⬅</button>
  <div id="resume-container">
    <div class="resume-content-wrapper">
      <!-- 新增头部 -->
      <div class="resume-header">
        <img class="resume-photo" src="https://cdn.jsdelivr.net/gh/sizhousama/sizhousama.github.io@master/avator.jpg" alt="个人照片">
        <div class="resume-personal-info">
          <h1>贾仕通</h1>
          <p>6年前端经验 | 13727056861 | 741700076@qq.com | 深圳</p>
        </div>
      </div>
      <!-- 原有的个人优势部分 -->
      <div class="resume-section">
        <h2>个人优势</h2>
        <div class="resume-content">
          <ul>
            <li>6年前端开发经验,精通Html,CSS,JavaScript,TypeScript</li>
            <li>熟练使用VueJs/React主流MVVM框架及ElementUI/Ant Design UI框架开发项目,深入了解其原理</li>
            <li>熟悉前端工程化,擅长使用Webpack/Vite项目构建,具备构建高效、可维护前端架构的能力</li>
            <li>擅长使用Electron框架开发windows/macos桌面应用,熟悉Electron原理,熟悉NodeJs,了解C++</li>
            <li>具备AI领域开发经验,擅长利用AI技术通过精准Prompt辅助开发及解决问题</li>
          </ul>
        </div>
      </div>
      <!-- 补全工作经历部分 -->
      <div class="resume-section">
        <h2>工作经历</h2>
        <div class="resume-content">
          <div class="experience-item">
            <h3>
              <img src="https://cdn.jsdelivr.net/gh/sizhousama/sizhousama.github.io@master/anker.jpg" alt="Anker Logo" class="company-logo">
              安克创新科技股份有限公司
              <span class="time">2022.08 - 至今</span>
            </h3>
            <div class="position">前端开发工程师</div>
            <ul>
              <li>担任前端负责人，主导多个项目的开发与维护,包括PC客户端、Web管理平台、App内嵌H5页面等。</li>
              <li>主导项目架构设计和搭建工作,并完成可供多个项目复用的公共模块和方法的封装</li>
              <li>负责项目分支管理和持续集成、部署(CI/CD)流程的搭建,有效提高了整体流程的执行效率。</li>
              <li>在部门内进行前端技术培训,降低工作沟通成本,提升团队整本技术水平和工作效率。</li>
            </ul>
            <div class="achievement">成绩：3年两次获得A+绩效，并获得两次季度Spot Bouns员工</div>
          </div>
          <div class="experience-item">
            <h3>
              <img src="https://cdn.jsdelivr.net/gh/sizhousama/sizhousama.github.io@master/mob.jpg" alt="摩比可可网络科技有限公司" class="company-logo">
              摩比可可网络科技有限公司 
              <span class="time">2020.8 - 2022.8</span>
            </h3>
            <div class="position">前端开发工程师</div>
            <ul>
              <li>负责项目核心模块的开发与维护工作，项目重构及可复用模块的编写</li>
              <li>负责部分前端工程化,如技术选型,eslint规范,git规范,前端性能优化等</li>
            </ul>
            <div class="achievement">成绩：2021年最具价值工程师奖，多次获得优秀研发人员奖</div>
          </div>
          <div class="experience-item">
            <h3>
              <img src="https://cdn.jsdelivr.net/gh/sizhousama/sizhousama.github.io@master/yoke.jpg" alt="深圳市有家生活家居有限公司" class="company-logo">
              深圳市有家生活家居有限公司 
              <span class="time">2019.8 - 2020-8</span>
            </h3>
            <div class="position">前端开发工程师</div>
            <ul>
              <li>独立开发公司小程序,app,以及部分web项目,与后台配合接口调试,实现数据交互与展示</li>
              <li>负责项目的版本选代更新,修复BUG,兼容问题,优化代码结构和页面性能,保证执行效率,提高用户体验度</li>
            </ul>
            <div class="achievement">成绩：优化小程序用户体验,提升大量用户日活</div>
          </div>
        </div>
      </div>
      <!-- 新增项目经历部分 -->
      <div class="resume-section">
        <h2>项目经历</h2>
        <div class="resume-content">
          <div class="project-item">
            <h3>AnkerWork & AnkerDockManager·前端主责<span class="time">2023.02 - 至今</span></h3>
            <p class="tech-stack">技术栈：Electron + Vue3 + TypeScript + Pinia + Element-plus</p>
            <p class="project-desc">项目概述：公司会议机、耳机、摄像头、拓展坞等设备的桌面端管理工具，功能包括设备OTA，数据展示及设备设置</p>
            <ul>
              <li>主导项目整体架构设计与框架搭建，编写公共类与组件，并将基础模块封装为node module</li>
              <li>引入addon封装C++模块通过inversify依赖注入到业务层供JS调用，CPU占用率降低40%</li>
              <li>通过asar，webpack代码压缩，Tree shaking等技术，优化安装包体积40%</li>
              <li>负责项目分支管理,CI/CD自动化构建及代码扫描规则配置</li>
            </ul>
            <div class="results">
              <p>项目成果：</p>
              <ul>
                <li>从Qt完整迁移至Electron,为公司节省每年数万元的License费用</li>
                <li>用户评分星级从3.9提升至4.7，用户满意度显著提高</li>
              </ul>
            </div>
          </div>
          <div class="project-item">
            <h3>Anker应用组件市场·全栈工程师<span class="time">2023.10 - 2023.12</span></h3>
            <p>项目概述: 公司内源建设平台，所有日常开发需要使用的组件，模块，方法都可以在平台内找到</p>
            <p>技术栈: 前端: React + Ant Design 后端: Golang+Gin+Mysql56.7</p>
            <ul>
              <li>负责项目UI设计、前后端开发、部署工作</li>
              <li>负责项目与飞书及coding打通，实现业务闭环</li>
            </ul>
            <div class="results">
              <p>项目成果：</p>
              <ul>
                <li>减少大量重复开发时间，提高公共资源利用率，显著提高开发效率</li>
                <li>组件复用率提升70%，开发周期缩短40%</li>
                <li>平台月活用户达500+，组件下载量突破10000次</li>
              </ul>
            </div>
          </div>
          <div class="project-item">
            <h3>souncore Help&Feedback 前端负责人<span class="time">2024.5 - 至今</span></h3>
            <p>项目概述: souncore App内嵌H5，包含产品Faq, Feedback和部分运营相关功能</p>
            <p>技术栈: React (modern.js + arco-design)</p>
            <ul>
              <li>承接日常需求，完成软件需求评审，软件设计方案编写</li>
              <li>负责项目架构设计和核心功能开发</li>
              <li>优化页面性能和用户体验</li>
              <li>实现多语言支持和自适应布局</li>
            </ul>
            <div class="results">
              <p>项目成果：</p>
              <ul>
                <li>页面加载时间优化至2秒以内，提升用户体验</li>
                <li>用户反馈处理效率提升50%</li>
                <li>移动端适配率达99%，兼容性测试通过率100%</li>
              </ul>
            </div>
          </div>
          <div class="project-item">
            <h3>蜂巢SCRM管理系统·前端工程师<span class="time">2020.06 - 2022.06</span></h3>
            <p>项目概述: 集成多个社媒渠道的用户管理平台,拥有傻瓜式起建站系统,让用户无忧建站,大幅降低人力财力及时间成本</p>
            <p>技术栈：Vue.js+TypeScript+ElementUI grapes.js jsPlumb</p>
            <ul>
              <li>负责核心模块（建站系统，自动化流程）的开发和维护</li>
              <li>建站模块基于Grapes.js，将插件二次封装，实现零代码可视化拖拽建站</li>
              <li>自动化流程模块基于jsplumb，将流程图绘制为可视化流程图</li>
            </ul>
            <div class="results">
              <p>项目成果：</p>
              <ul>
                <li>站点模块完成后成为系统的主要卖点,相比普通版本销售额提升10倍</li>
              </ul>
            </div>
          </div>
          <div class="project-item">
            <h3>蜂巢聊天小程序 前端工程师<span class="time">2021.08 - 2021.12</span></h3>
            <p>项目概述：为商家打造的专属聊天小程序，让商家能够随时随地触达客户</p>
            <p>技术栈：react(taro.js框架)+taro-ui+socket.io-client</p>
            <ul>
              <li>独立开发整个项目，搭建框架，规范代码规则，编写可复用组件等</li>
              <li>构建socket.io通信体系，实现兼容多渠道的实时通信</li>
              <li>处理socket.io在小程序端的兼容性问题，以及聊天窗口的复杂布局问题</li>
            </ul>
            <div class="results">
              <p>项目成果：</p>
              <ul>
                <li>作为web端的附加功能卖点，在不降低系统使用率的同时，增加了销量，平均日活占所有用户的85%；消息送达率提升至99.9%，延迟降低至100ms以内</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- 新增教育经历部分 -->
      <div class="resume-section">
        <h2>教育经历</h2>
        <div class="resume-content">
          <div class="experience-item">
            <h3>珠海科技学院 计算机科学与技术·本科 20XX - 20XX</h3>
            <ul>
              <li>主修计算机科学与技术专业,熟练掌握计算机科学的基本理论和基本知识</li>
              <li>毕业设计获得了优秀毕业论文</li>
            </ul>
          </div>
        </div>
      </div>
      <div style="height: 100px;"></div>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';

    // 创建场景、相机和渲染器
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ 
      antialias: true,
      alpha: true,
      preserveDrawingBuffer: true,
      logarithmicDepthBuffer: true,
      powerPreference: "high-performance"  // 优先使用高性能GPU
    });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));  // 限制像素比
    renderer.setSize(300, 300);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.5;
    document.body.appendChild(renderer.domElement);

    // 创建对话框元素
    const dialog = document.getElementById('dialog');
    let currentText = '';
    let isDialogVisible = false;
    
    // 使用节流函数优化对话框位置更新
    function throttle(func, limit) {
      let inThrottle;
      return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
          func.apply(context, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      }
    }
    
    // 更新对话框位置
    const updateDialogPosition = throttle(function() {
      const modelPosition = new THREE.Vector3(0, 1, 0);
      modelPosition.project(camera);
      
      const canvasRect = renderer.domElement.getBoundingClientRect();
      
      const x = (modelPosition.x * 0.5 + 0.5) * (isMobile ? 200 : 300);
      const y = (-modelPosition.y * 0.5 + 0.5) * (isMobile ? 200 : 300);
      
      dialog.style.left = `${canvasRect.left + x + (isMobile ? 40 : 80)}px`;
      dialog.style.top = `${canvasRect.top + y - (isMobile ? 30 : 50)}px`;
      
      if (!isDialogVisible) {
        dialog.style.display = 'block';
        dialog.classList.add('visible');
        typeWriter(dialog, 'Hello，我是简历AI助手，您可以将岗位描述告诉我，我将检测我的岗位匹配度！');
        isDialogVisible = true;
      }
    }, 100);

    // 添加打字机效果
    async function typeWriter(element, text, speed = 50) {
      element.textContent = '';
      for (let i = 0; i < text.length; i++) {
        element.textContent += text[i];
        await new Promise(resolve => setTimeout(resolve, speed));
      }
    }

    // 设置对话框初始状态
    dialog.style.display = 'none';
    dialog.classList.remove('visible');
    isDialogVisible = false;

    // 添加鼠标移动事件监听
    renderer.domElement.addEventListener('mousemove', () => {
      updateDialogPosition();
    });

    // 添加鼠标离开事件监听
    renderer.domElement.addEventListener('mouseleave', () => {
      if (isDialogVisible) {
        dialog.classList.remove('visible');
        setTimeout(() => {
          dialog.style.display = 'none';
          isDialogVisible = false;
        }, 300);
      }
    });

    // 优化光源设置
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
    directionalLight.position.set(5, 5, 5);
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048;  // 减小阴影贴图大小
    directionalLight.shadow.mapSize.height = 2048;
    directionalLight.shadow.camera.near = 0.1;
    directionalLight.shadow.camera.far = 100;
    directionalLight.shadow.bias = -0.001;
    scene.add(directionalLight);

    // 优化控制器设置
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.screenSpacePanning = false;
    controls.minDistance = 2;
    controls.maxDistance = 10;
    controls.maxPolarAngle = Math.PI / 2;
    controls.rotateSpeed = 0.5;  // 降低旋转速度
    controls.enableZoom = true;
    controls.enablePan = false;

    // 优化渲染循环
    let lastTime = 0;
    const targetFPS = 60;
    const frameInterval = 1000 / targetFPS;

    function animate(currentTime) {
      requestAnimationFrame(animate);

      const deltaTime = currentTime - lastTime;
      if (deltaTime >= frameInterval) {
        // 更新控制器
        controls.update();

        // 更新动画混合器
        if (mixer) {
          const delta = Math.min(deltaTime / 1000, 0.1);  // 限制最大delta时间
          mixer.update(delta);
        }

        // 更新对话框位置
        // updateDialogPosition();

        renderer.render(scene, camera);
        lastTime = currentTime;
      }
    }

    // 优化窗口大小调整事件
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        camera.aspect = renderer.domElement.width / renderer.domElement.height;
        camera.updateProjectionMatrix();
        renderer.setSize(renderer.domElement.width, renderer.domElement.height);
      }, 100);  // 延迟100ms执行
    });

    // 优化聊天消息滚动
    function scrollToBottom() {
      const chatMessages = document.getElementById('chat-messages');
      if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    // 使用防抖函数优化滚动
    const debouncedScroll = debounce(scrollToBottom, 100);

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // 优化消息添加函数
    function addMessage(message, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}-message`;
      messageDiv.textContent = message;
      chatMessages.appendChild(messageDiv);
      debouncedScroll();
    }

    // 优化流式响应处理
    async function processStreamResponse(reader, messageDiv, dialogBox) {
      const decoder = new TextDecoder();
      let aiResponse = '';
      
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');
        
        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6);
            if (data === '[DONE]') break;
            
            try {
              const parsed = JSON.parse(data);
              if (parsed.choices[0].delta.content) {
                const content = parsed.choices[0].delta.content;
                aiResponse += content;
                messageDiv.textContent = aiResponse;
                dialogBox.textContent = aiResponse;
                debouncedScroll();
              }
            } catch (e) {
              console.error('解析响应数据出错:', e);
            }
          }
        }
      }
    }

    // 设置相机位置
    camera.position.set(0, 0.5, 8);  // 将相机高度从2调整到3，使其稍微向上仰视

    // 加载 FBX 模型
    const loader = new FBXLoader();
    let mixer; // 用于动画混合
    let actions = []; // 存储所有动画动作
    let currentAction = null; // 当前播放的动画

    // 获取加载相关元素
    const loadingContainer = document.getElementById('loading-container');
    const loadingText = document.getElementById('loading-text');
    const progressBar = document.getElementById('progress');

    // loader.load(
    //   'https://cdn.jsdelivr.net/gh/sizhousama/sizhousama.github.io@master/model.fbx',
    //   function (object) {
    //     // 加载完成后隐藏加载界面
    //     setTimeout(() => {
    //       loadingContainer.classList.add('hidden');
    //     }, 500);

    //     // 调整模型大小和位置
    //     object.scale.set(0.07, 0.07, 0.07);  // 调整模型大小
    //     object.position.set(-1, -3.5, 0);  // 调整Y轴位置，使模型居中
    //     object.rotation.y = -Math.PI/2;  // 保持模型朝向
        
    //     // 遍历模型的所有材质，调整材质属性
    //     object.traverse((child) => {
    //       if (child.isMesh) {
    //         child.castShadow = true;
    //         child.receiveShadow = true;
            
    //         // 如果材质存在，调整材质属性
    //         if (child.material) {
    //           // 创建新的标准材质
    //           const newMaterial = new THREE.MeshStandardMaterial({
    //             map: child.material.map,  // 保留原始纹理
    //             color: child.material.color,  // 保留原始颜色
    //             metalness: 0.1,  // 非常低的金属度
    //             roughness: 0.7,  // 适中的粗糙度
    //             envMapIntensity: 0.3,  // 较低的环境贴图强度
    //             side: THREE.DoubleSide,
    //             transparent: child.material.transparent,
    //             opacity: child.material.opacity
    //           });

    //           // 复制原始材质的贴图
    //           if (child.material.normalMap) newMaterial.normalMap = child.material.normalMap;
    //           if (child.material.aoMap) newMaterial.aoMap = child.material.aoMap;
    //           if (child.material.roughnessMap) newMaterial.roughnessMap = child.material.roughnessMap;

    //           // 应用新材质
    //           child.material = newMaterial;
    //           child.material.needsUpdate = true;
    //         }

    //         // 优化几何体
    //         if (child.geometry) {
    //           child.geometry.computeVertexNormals();  // 重新计算法线
    //           child.geometry.computeBoundingSphere();  // 重新计算包围球
    //         }
    //       }
    //     });
        
    //     scene.add(object);

    //     // 如果模型包含动画，设置动画混合器
    //     if (object.animations && object.animations.length > 0) {
    //       console.log('找到动画数量:', object.animations.length);
    //       object.animations.forEach((clip, index) => {
    //         console.log(`动画 ${index + 1}:`, clip.name);
    //       });

    //       // 更新加载进度到90%
    //       progressBar.style.width = '90%';
    //       loadingText.textContent = '正在加载动画...';

    //       mixer = new THREE.AnimationMixer(object);
          
    //       // 创建所有动画动作
    //       object.animations.forEach((clip) => {
    //         const action = mixer.clipAction(clip);
    //         actions.push(action);
    //       });

    //       // 默认播放第一个动画
    //       if (actions.length > 0) {
    //         currentAction = actions[0];
    //         currentAction.play();
    //         console.log('开始播放第一个动画');
            
    //         // 完成加载，进度条到100%
    //         setTimeout(() => {
    //           progressBar.style.width = '100%';
    //           loadingText.textContent = '加载完成！';
    //           setTimeout(() => {
    //             loadingContainer.classList.add('hidden');
    //           }, 500);
    //         }, 500);
    //       }
    //     } else {
    //       console.log('警告：模型中没有找到动画数据');
    //       // 如果没有动画，直接完成加载
    //       progressBar.style.width = '100%';
    //       loadingText.textContent = '加载完成！';
    //       setTimeout(() => {
    //         loadingContainer.classList.add('hidden');
    //       }, 500);
    //     }
    //   },
    //   function (xhr) {
    //     const percent = (xhr.loaded / xhr.total * 100) * 0.9; // 模型加载占90%的进度
    //     // 使用requestAnimationFrame确保进度条更新更平滑
    //     requestAnimationFrame(() => {
    //       progressBar.style.width = `${percent}%`;
    //       loadingText.textContent = `加载中... ${Math.round(percent)}%`;
    //     });
    //   },
    //   function (error) {
    //     console.error('加载模型时出错:', error);
    //     loadingText.textContent = '加载失败，请刷新页面重试';
    //     loadingText.style.color = '#ff4444';
    //   }
    // );

    animate();

    // 添加聊天功能
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');
    const dialogBox = document.getElementById('dialog');  // 重命名变量避免冲突

    // 替换为你的OpenAI API密钥
    const OPENAI_API_KEY = 'sk-81e07dcd42a2468892da1e5b9d0ed43b';
    const API_URL = 'https://api.deepseek.com/chat/completions';

    async function sendMessage(message) {
      try {
        // 显示用户消息
        addMessage(message, 'user');
        
        // 创建AI回复消息元素
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message ai-message';
        chatMessages.appendChild(messageDiv);
        
        // 显示对话框
        dialogBox.style.display = 'block';

        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              {
                role: 'system',
                content: '你是一个友好的3D虚拟助手，请用简短友好的语气回答。不超过100个字'
              },
              {
                role: 'user',
                content: message
              }
            ],
            stream: true,
            max_tokens: 200
          })
        });
        
        // 处理流式响应
        const reader = response.body.getReader();
        await processStreamResponse(reader, messageDiv, dialogBox);
      } catch (error) {
        console.error('Error:', error);
        const errorMessage = '抱歉，我现在无法回答。';
        messageDiv.textContent = errorMessage;  // 使用已创建的messageDiv
        dialogBox.style.display = 'block';
        dialogBox.textContent = errorMessage;
      }
    }

    function handleSend() {
      const message = chatInput.value.trim();
      if (message) {
        sendMessage(message);
        chatInput.value = '';
      }
    }

    sendButton.addEventListener('click', handleSend);
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        handleSend();
      }
    });

    // 修改聊天框显示/隐藏功能
    const chatHide = document.getElementById('chat-hide');
    const chatShow = document.getElementById('chat-show');
    const chatContainer = document.getElementById('chat-container');
    let isChatVisible = true;

    // 检查是否为移动设备
    const isMobile = window.innerWidth <= 768;

    chatHide.addEventListener('click', () => {
      isChatVisible = false;
      if (isMobile) {
        chatContainer.style.transform = 'translateX(100%)';
      } else {
        chatContainer.style.transform = 'translateX(470px)';
      }
      chatHide.style.display = 'none';
      chatShow.style.display = 'flex';
    });

    chatShow.addEventListener('click', () => {
      isChatVisible = true;
      chatContainer.style.transform = 'translateX(0)';
      chatShow.style.display = 'none';
      chatHide.style.display = 'flex';
    });

    // 添加窗口大小改变事件监听
    window.addEventListener('resize', () => {
      const newIsMobile = window.innerWidth <= 768;
      if (newIsMobile !== isMobile) {
        if (newIsMobile && isChatVisible) {
          chatContainer.style.transform = 'translateX(100%)';
          chatHide.style.display = 'none';
          chatShow.style.display = 'flex';
        }
      }
    });

    // 初始化欢迎消息
    addMessage('Hello，我是Evan简历AI助手，您可以将岗位描述告诉我，我将检测Evan与您的岗位匹配度哦！', 'ai');
  </script>
</body>
</html>